// db/db.js - –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å Neon

import 'dotenv/config'; 
import pg from 'pg';

// –ò—Å–ø–æ–ª—å–∑—É–µ–º DATABASE_URL –∏–∑ .env, –µ—Å–ª–∏ –æ–Ω–∞ –µ—Å—Ç—å
const connectionString = process.env.DATABASE_URL;

if (!connectionString) {
    console.error("‚ùå –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê: –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è DATABASE_URL –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –≤ .env!");
    process.exit(1); // –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ, –µ—Å–ª–∏ –Ω–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
}

// üí° –ò—Å–ø–æ–ª—å–∑—É–µ–º –æ–±—ä–µ–∫—Ç, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Å—Ç—Ä–æ–∫—É connectionString
const pool = new pg.Pool({
    connectionString: connectionString,
    // –í–ê–ñ–ù–û: Node-Postgres –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç SSL –∏–∑ URI, 
    // –Ω–æ —è–≤–Ω–æ —É–∫–∞–∑–∞—Ç—å –µ–≥–æ - —Ö–æ—Ä–æ—à–∞—è –ø—Ä–∞–∫—Ç–∏–∫–∞ –¥–ª—è Neon.
    ssl: {
        rejectUnauthorized: false // Neon —Ç—Ä–µ–±—É–µ—Ç SSL, –Ω–æ –º—ã –Ω–µ –≤—Å–µ–≥–¥–∞ –º–æ–∂–µ–º –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –µ–≥–æ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –≤ dev-—Å—Ä–µ–¥–µ
    }
});

// –ü—Ä–æ–≤–µ—Ä–∫–∞: —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
pool.connect((err, client, release) => {
    if (err) {
        // –ó–¥–µ—Å—å –≤—ã —É–≤–∏–¥–∏—Ç–µ –æ—à–∏–±–∫—É, –µ—Å–ª–∏ –ø–∞—Ä–æ–ª—å –∏–ª–∏ —Ö–æ—Å—Ç –Ω–µ–≤–µ—Ä–Ω—ã
        return console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö Neon:', err.stack);
    }
    console.log('‚úÖ –£—Å–ø–µ—à–Ω–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Neon PostgreSQL!');
    release(); 
});

export default pool;